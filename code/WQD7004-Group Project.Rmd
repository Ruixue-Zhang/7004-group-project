---
title: "**WQD7004 - Group 10 Project - Credit Risk Prediction**"
date: | 
output: 
  pdf_document:
    latex_engine: xelatex
header-includes:
   - \usepackage{setspace}
   - \doublespacing
geometry: margin=1in
fontsize: 12pt
mainfont: Calibri
sansfont: Calibri
monofont: Calibri
spacing: double
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
## Group No.: 10
## Group Members

* LINGYU MENG (S2131391)

* HUIJUN LIU (S2142285)

* ZUOGE CHEN (S2125783)

* KELVIIN RAJJ KARUPAYA (S2151665)

* RUIXUE ZHANG (S2142119)

## Dataset


* Title: German Credit Risk

* Year: 2020

* Content: This dataset classifies people described by a set of attributes as good or bad credit risks.

* Source: https://www.kaggle.com/datasets/kabure/german-credit-data-with-risk


# 1 Introduction

In this dataset, each entry represents a person who takes a credit by a bank. Each person is classified as good or bad credit risks according to the set of attributes.
 
## 1.1 Project Objective

To manage and avoid the credit risk of users.
  
## 1.2 Project Question

* predict credit amount (regression)

* what variables most related to the credit amount? (classification)

* What level of risk does the customer belong to？

* What is the credit limit of the customer？

# 2 Data Pre-processing

## 2.1 Data Understanding

### Import libraries

```{r import libraries, message=FALSE, warning=FALSE}
library(dplyr)
library(readr)
library(VIM)
library(missForest)
library(Hmisc)
library(caret)
library(ggplot2)
library(e1071)
library(klaR)
library(nnet)
library(Metrics)
library(rpart)
library(tidyverse)

```

### Read data

```{r,message=FALSE}
df=read.csv('german_credit_data.csv')
# Delete the 1st column which is used for indexing.
df=df[,-1]
head(df)

```

### See the structure of dataset

```{r str}
str(df)

```

## 2.2 Handle missing data

### Check missing values

```{r check NAs}
print(paste('Complete obs.:',sum(complete.cases(df))))

```

* Distribution of NAs (by column):

```{r}
colSums(is.na(df))

```

* Check if any missing value is "" type

```{r}
colSums(df=="")

```

### Visualisation of missing part

```{r VIM}
aggr(df,labels=names(df),col=c('blue','red'),
     numbrs=T,sortVars=T)

```

As shown above, Saving.accounts & Check.account contain missing values, and red color presents missing part.

### Predict and impute NAs

**Step 1: Convert chr variables to factor type**

```{r convert type}
df1 <- df
df1$Sex <- as.factor(df1$Sex)
df1$Job <- as.ordered(df1$Job)
df1$Housing <- as.factor(df1$Housing)
df1$Saving.accounts <- as.ordered(df1$Saving.accounts)
df1$Checking.account <- as.ordered(df1$Checking.account)
df1$Purpose <- as.factor(df1$Purpose)
df1$Risk <- as.ordered(df1$Risk)

```

**Step 2: Impute NAs using missForest**

**missForest** is used to impute missing values particularly in the case of mixed-type data. It can be used to impute **continuous and/or categorical** data including complex interactions and nonlinear relations. It yields an out-of-bag (OOB) imputation error estimate. Moreover, it can be run parallel to save computation time.  
  
```{r missForest}
df.mis <- df1[!complete.cases(df1),]
df.train <- df1[complete.cases(df1),]
set.seed(42)
df.imp <- missForest(xmis = df.mis, xtrue = df.train, maxiter = 10, ntree = 200)
message('Out of Bag error: ', df.imp$OOBerror)

```

**Save imputation result**

```{r impute}
df.nomis <- df1
df.nomis[!complete.cases(df.nomis),] <- df.imp$ximp

```

**Saving.Account values distribution after imputation:**

```{r}
table(df.nomis$Saving.accounts)

```

**Checking.Account values distribution after imputation:**

```{r}
table(df.nomis$Checking.account)

```

## 2.3 Smooth noisy data (Not yet decided)

```{r eval=FALSE, include=FALSE}
Age_bp <- boxplot(df.nomis$Age,boxwex=0.7)
Age_bp$out
CredAmt_bp <- boxplot(df.nomis$Credit.amount, boxwex=0.7)
CredAmt_bp$out
Duration_bp <- boxplot(df.nomis$Duration,boxwex=0.7)
Duration_bp$out
```


* Save cleaned dataset

```{r save dataset}
write.csv(df.nomis,file = 'german_credit_data_rmna.csv',row.names=F)

```

* Summary dataset

```{r summary}
summary(df.nomis)

```



### Descriptions of cleaned dataset

* Age: (quantitative, in years)
* Sex: (dichotomous: female, male)
* Job: (ordinal: 0 - unskilled and non-resident, 1 - unskilled and resident, 2 - skilled, 3 - highly skilled)
* Housing: (nominal: own, rent, or free)
* Saving.accounts: (ordinal: little, moderate, quite rich, rich) - Status of existing saving account.
* Checking.account: (ordinal: little, moderate, rich) - Status of existing checking account.
* Credit.amount: (quantitative, in D-mark) The maximum amount that the bank is committed to lend.
* Duration: (quantitative, in month) The specified time to pay the credit.
* Purpose: (nominal: car, furniture/equipment, radio/TV, domestic appliances, repairs, education, business, vacation/others) - Reasons to get a loan.
* Risk: (dichotomous : good, bad)
